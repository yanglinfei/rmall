# 用户模块

### 功能介绍

登录、用户名验证、注册、忘记密码、提交问题答案、重置密码、获取用户信息、更新用户信息、退出登录

### 功能特点

- 横向越权、纵向越权漏洞
  - 横向越权：攻击者尝试访问与他拥有相同权限用户的资源
  - 纵向越权：低级别攻击者尝试访问高级别用户的资源
- MD5明文加密及增加salt值
- 使用Guava缓存
- 使用Session保存登录信息

### 数据表设计

| rmall_user  | 类型     |
| ----------- | -------- |
| id          | int      |
| username    | varchar  |
| password    | varchar  |
| email       | varchar  |
| phone       | varchar  |
| question    | varchar  |
| answer      | varchar  |
| role        | varchar  |
| create_time | datetime |
| update_time | datetime |

### 接口设计

/user路径下

1. 登录

   /user/login.do

   ```java
   ServerResponse<User> login(String username, String password, HttpSession session)
   ```

2. 登出

   /logout.do

   ```java
   ServerResponse<String> logout(HttpSession session)
   ```

3. 注册

   /register

   ```java
   ServerResponse<String> register(User user)
   ```

4. 查看用户名是否有效

   /check_valid.do

   ```java
   ServerResponse<String> checkValid(String str, String type)
   ```
5. 获取用户信息

   /get_user_info.do

   ```java
   ServerResponse<User> getUerInfo(HttpSession session)
   ```
6. 忘记密码

   /forget_get_question.do

   ```java
   ServerResponse<String> forgetGetQuestion(String username)
   ```
7. 校验忘记密码答案

   /forget_check_answer.do

   ```java
   ServerResponse<String> forgetCheckAnswer(String username, String question, String answer)
   ```
8. 重置密码（忘记密码）

   /forget_reset_password.do

   ```java
   ServerResponse<String> forgetResetPassword(String username, String newPassword, String forgetToken)
   ```
9. 重置密码

   /reset_password.do

   ```java
   ServerResponse<String> resetPassword(HttpSession session, String oldPassword, String newPassword)
   ```
10. 更新用户信息

   /update_information.do

   ```java
   ServerResponse<User> updateInformation(HttpSession session, User user)
   ```
11. 获取用户信息

   /get_user_information.do

   ```java
   ServerResponse<User> getUserInfomation(HttpSession session)
   ```
   
